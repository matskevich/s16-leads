# Scope: project
# Priority: 00
# Назначение
Базовая «конституция» проекта: безопасность на живом коде и процедура работы агента.

## Как читать правила
- Прочитай все файлы из `.cursor/rules/*.md`.
- Приоритет: **project (.cursor/rules/*) > external** (Memory Bank / Custom Modes).
- Среди project-файлов побеждает **больший числовой префикс** (напр., `70-*` > `60-*` > `00-*`).
- Если внешнее правило конфликтует или расширяет скоп — **остановись и спроси**.

## НФР / Безопасность (MUST)
- Не менять поведение прод-сервиса без явной моей команды.
- Работать в отдельной ветке. Зависимости/линт/форматирование — не трогать, если задача не об этом.
- Секреты/PII не писать в код и логи; `.env.sample` — без секретов.
 - Все изменения — атомарные коммиты по партиям (1–5) согласно плану миграции.

## Процедура (MUST)
- Всегда **dry-run → diff → apply** малыми партиями.
- Сначала выведи обзор: какие файлы затронешь и какие diffs предлагаешь (без применения).
- После моего подтверждения — применяй **только** конкретно названные шаги (например, `apply steps 1–2`).
 - Не трогать форматирование/линтинг и не обновлять зависимости без явной команды.

## Kickoff-артефакты (текстовые, без правок кода)
На старте сгенерируй/обнови и покажи diff:
- `MIGRATION_PLAN.md` — план миграции (шаги, риски, критерии готовности, откат).
- `PROPOSED_TREE.md` — целевое дерево папок/файлов.
- `MOVE_MAP.md` — карта перемещений файл→файл (as-is → to-be).
- `IMPORT_REWRITE.md` — правила переписывания импортов (old → new).

## HELLOVIEW / CONTEXT (обязательное к чтению)
- Перед любыми изменениями **прочитай `docs/HELLO_AGENT.md`** и следуй ему как источнику контекста:
  - одна Telegram-сессия, общий глобальный лимитер для всех apps;
  - всё общее — в `packages/tg_core` (infra/domain/config/typing);
  - `apps/*` тонкие, без прямых вызовов Telethon (только через `tg_core.TelegramGateway.safe_call`);
  - миграция — маленькими партиями (scaffold → move common → app split → fix imports → tests/guardrails).
- Если обнаружен конфликт между HelloView и текущим кодом — **остановись и задай вопросы**.

## STOP-условия
- Требуется расширить объём задачи за пределы описанного — спроси.
- Неясные/неразрешённые зависимости — спроси.
- Любое расхождение между правилами (60/70) и тем, что предлагаешь применить — спроси.
 - Любой diff вне `MOVE_MAP.md` — откатить и спросить.


